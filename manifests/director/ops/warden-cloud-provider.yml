# Ops file: Set cloud_provider to warden CPI for bosh create-env
# The bosh-warden-cpi release is already added by bosh-lite.yml,
# so this ONLY configures the cloud_provider section (used by create-env)
# and the stemcell + resource_pool cloud_properties.

# Set cloud_provider template to warden
- path: /cloud_provider/template?
  type: replace
  value:
    name: warden_cpi
    release: bosh-warden-cpi

# Configure warden CPI properties for cloud_provider
- path: /cloud_provider/properties/warden_cpi?
  type: replace
  value:
    actions:
      expand_stemcell_tarball: false
    agent:
      blobstore:
        options:
          blobstore_path: /var/vcap/micro_bosh/data/cache
        provider: local
      mbus: https://mbus:((mbus_bootstrap_password))@0.0.0.0:6868
    start_containers_with_systemd: false
    warden:
      connect_address: 127.0.0.1:7777
      connect_network: tcp

# Set stemcell (Noble â€” must match host VM OS for glibc compatibility)
- path: /resource_pools/name=vms/stemcell?
  type: replace
  value:
    sha1: d8fb908d03942198018e584e1ff88ce14444d6cd
    url: https://storage.googleapis.com/bosh-core-stemcells/1.215/bosh-stemcell-1.215-warden-boshlite-ubuntu-noble.tgz

# Configure resource pool for warden container
- path: /resource_pools/name=vms/cloud_properties?
  type: replace
  value:
    ports:
    - host: 6868
    - host: 25555
    - host: 4222
    - host: 25250
    - host: 8443
    - host: 8080
